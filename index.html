<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mountaineer Rush - Game</title>
<style>
  *{margin:0;padding:0;box-sizing:border-box;user-select:none;-webkit-tap-highlight-color:transparent;}
  html,body{width:100%;height:100%;overflow:hidden;background:#3a5a32;font-family:sans-serif;}
  #gameContainer{position:relative;width:400px;height:700px;margin:20px auto;border-radius:15px;box-shadow:0 0 25px #122a08;overflow:hidden;background:#2c4a18;}
  canvas{display:block;border-radius:15px;background:linear-gradient(to top,#4b7c41 0%,#a3c89d 60%,#d9f4d8 100%);}
  #ui{position:absolute;top:15px;left:15px;color:#fff;font-size:20px;font-weight:700;text-shadow:1px 1px 3px rgba(0,0,0,0.7);z-index:20;}
  #ui .power{margin-left:20px;color:#ffec3d;}
  #gameOverScreen{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.85);padding:30px 40px;border-radius:12px;color:#fff;font-size:26px;font-weight:700;text-align:center;display:none;z-index:30;user-select:none;}
  #gameOverScreen button{margin-top:20px;padding:12px 35px;font-size:18px;font-weight:600;border:none;border-radius:10px;background:#4caf50;color:#fff;cursor:pointer;transition:background-color 0.3s ease;}
  #gameOverScreen button:active{background:#388e3c;}
  #controls{position:absolute;bottom:20px;width:100%;display:flex;justify-content:center;gap:25px;z-index:25;user-select:none;}
  .btn{background:rgba(255,255,255,0.3);border-radius:50%;width:70px;height:70px;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 2px 7px rgba(0,0,0,0.5);transition:background 0.25s ease;}
  .btn:active{background:rgba(255,255,255,0.6);}
  svg{width:35px;height:35px;fill:#204000;}
</style>
</head>
<body>
<div id="gameContainer" role="main" aria-label="Mountaineer Rush Game">
  <canvas id="gameCanvas" width="400" height="700" aria-live="polite" aria-label="Game canvas"></canvas>
  <div id="ui">Score: 0<span class="power"></span></div>
  <div id="gameOverScreen" role="alertdialog" aria-modal="true" aria-labelledby="gameOverTitle" aria-describedby="finalScoreText">
    <div id="gameOverTitle">Game Over!</div>
    <div id="finalScoreText"></div>
    <button id="restartBtn" aria-label="Restart Game">Restart</button>
  </div>
  <div id="controls" role="region" aria-label="Game controls">
    <div class="btn" id="leftBtn" aria-label="Move Left" role="button" tabindex="0">
      <svg viewBox="0 0 24 24"><path d="M15 18l-6-6 6-6"/></svg>
    </div>
    <div class="btn" id="rightBtn" aria-label="Move Right" role="button" tabindex="0">
      <svg viewBox="0 0 24 24"><path d="M9 6l6 6-6 6"/></svg>
    </div>
  </div>
</div>
<script>
(() => {
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  const ui = document.getElementById('ui');
  const powerSpan = ui.querySelector('.power');
  const gameOverScreen = document.getElementById('gameOverScreen');
  const finalScoreText = document.getElementById('finalScoreText');
  const restartBtn = document.getElementById('restartBtn');
  const leftBtn = document.getElementById('leftBtn');
  const rightBtn = document.getElementById('rightBtn');
  const WIDTH = canvas.width;
  const HEIGHT = canvas.height;

  const playerImg = new Image();
  playerImg.src = 'https://i.imgur.com/3lDZUjq.png';
  const treeImg = new Image();
  treeImg.src = 'https://i.imgur.com/jT4cNsc.png';
  const rockImg = new Image();
  rockImg.src = 'https://i.imgur.com/FpOh7Pi.png';
  const waterImg = new Image();
  waterImg.src = 'https://i.imgur.com/NvZ5xtE.png';

  let player = {
    x: WIDTH/2 - 25,
    y: HEIGHT - 110,
    width: 50,
    height: 80,
    speed: 7,
    invincible: false,
    invincibleTimer: 0
  };

  let obstacles = [];
  let obstacleSpeed = 3;
  let spawnTimer = 0;
  let spawnInterval = 60;
  let score = 0;
  let highscore = parseInt(localStorage.getItem('mountainRushHighscore')) || 0;
  let running = true;
  let keys = {};
  let touchActive = {left: false, right: false};

  function rectsCollide(a,b) {
    return !(a.x + a.width < b.x || a.x > b.x + b.width || a.y + a.height < b.y || a.y > b.y + b.height);
  }

  function spawnObstacle() {
    let r = Math.random();
    let obj;
    if(r < 0.5) {
      obj = {type:'tree', width:40, height:60, img: treeImg};
    } else if(r < 0.85) {
      obj = {type:'rock', width:50, height:40, img: rockImg};
    } else {
      obj = {type:'water', width:50, height:30, img: waterImg};
    }
    obj.x = Math.random() * (WIDTH - obj.width);
    obj.y = -obj.height;
    obstacles.push(obj);
  }

  function update() {
    if(!running) return;

    if(keys['arrowleft'] || keys['a'] || touchActive.left) player.x -= player.speed;
    if(keys['arrowright'] || keys['d'] || touchActive.right) player.x += player.speed;
    if(player.x < 0) player.x = 0;
    if(player.x + player.width > WIDTH) player.x = WIDTH - player.width;

    spawnTimer++;
    if(spawnTimer >= spawnInterval) {
      spawnObstacle();
      spawnTimer = 0;
      if(spawnInterval > 20) spawnInterval -= 0.3;
      obstacleSpeed += 0.015;
    }

    for(let i=obstacles.length-1; i>=0; i--) {
      obstacles[i].y += obstacleSpeed;
      if(obstacles[i].y > HEIGHT) {
        obstacles.splice(i,1);
        score++;
        if(score > highscore) {
          highscore = score;
          localStorage.setItem('mountainRushHighscore', highscore);
        }
      }
    }

    for(let i=obstacles.length-1; i>=0; i--) {
      let o = obstacles[i];
      if(rectsCollide(player, o)) {
        if(o.type === 'water') {
          player.invincible = true;
          player.invincibleTimer = 300;
          obstacles.splice(i,1);
        } else {
          if(!player.invincible) {
            running = false;
            finalScoreText.textContent = `Score: ${score} | Highscore: ${highscore}`;
            gameOverScreen.style.display = 'block';
          } else {
            obstacles.splice(i,1);
          }
        }
      }
    }

    if(player.invincible) {
      player.invincibleTimer--;
      if(player.invincibleTimer <= 0) {
        player.invincible = false;
      }
    }
  }

  function draw() {
    ctx.clearRect(0,0,WIDTH,HEIGHT);
    // Background gradient done by CSS

    // Draw player (glow if invincible)
    if(player.invincible) {
      ctx.shadowColor = 'yellow';
      ctx.shadowBlur = 15;
    } else {
      ctx.shadowBlur = 0;
    }
    ctx.drawImage(playerImg, player.x, player.y, player.width, player.height